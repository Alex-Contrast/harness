{"id":"harness-06u","title":"Test parallel job execution in K8s","description":"Verify that multiple harness agent jobs can run concurrently without issues. From k8s_plan.md Phase 4.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:11:11.540605-05:00","updated_at":"2025-12-19T11:11:11.540605-05:00","labels":["phase4"]}
{"id":"harness-0sf","title":"Test CLI: harness test command for scenario execution","description":"Add CLI subcommand for running test scenarios.\n\nCommands:\n- harness test \u003cscenario.yaml\u003e - run single file\n- harness test --all - run all in scenarios/\n- harness test --tag vuln - filter by tag\n- harness test --output results.json - specify output\n- harness test --dry-run - show what would run\n\nAcceptance Criteria:\n- [ ] harness test command implemented\n- [ ] Supports file and directory input\n- [ ] --output flag for results path\n- [ ] --tag and --level filters\n- [ ] --dry-run shows scenarios without running\n- [ ] Exit code reflects pass/fail\n- [ ] --help documentation\n- [ ] Manual test: run suite from CLI","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-19T14:00:27.628539-05:00","updated_at":"2025-12-19T14:00:27.628539-05:00","labels":["appsec-testing"]}
{"id":"harness-238","title":"Repo Scanner: Scan directories for git repos and extract metadata","description":"Scan user-defined root directories for git repos (.git folders). Extract: repo name (from folder), path, detected languages, file count. Output list of discovered repos for indexing config.\n\nAcceptance Criteria:\n- [ ] Finds repos with .git folders recursively\n- [ ] Skips nested repos (submodules)\n- [ ] Extracts repo name from folder name\n- [ ] Detects primary language(s) by file extensions\n- [ ] Returns structured list of RepoInfo objects\n- [ ] Unit tests for scanner logic\n- [ ] Manual test: scan ~/dev with 5+ repos","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T12:41:51.186688-05:00","updated_at":"2025-12-19T13:14:20.836105-05:00","labels":["phase2-search"]}
{"id":"harness-3oh","title":"Agent Context: Auto-inject indexed repos list into system prompt","description":"Agent context from Qdrant + working directory. On startup: query Qdrant for distinct repos (option B). Also detect current working directory and prioritize that repo in searches. Format: 'Indexed repos: [list]. Current repo: billing-api (prioritized in search).'\n\nAcceptance Criteria:\n- [ ] Query Qdrant for distinct repo values on startup\n- [ ] Detect current working directory repo (if in indexed repo)\n- [ ] System prompt includes indexed repos list\n- [ ] System prompt highlights current repo if applicable\n- [ ] Graceful handling if Qdrant unavailable\n- [ ] Unit tests with mocked Qdrant\n- [ ] Manual test: run agent in repo dir, verify context correct","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T12:41:53.00503-05:00","updated_at":"2025-12-19T13:14:35.879702-05:00","labels":["phase2-search"]}
{"id":"harness-3r8","title":"Automation: Git webhook trigger for automatic reindexing","description":"Optional: Set up webhook endpoint that triggers reindexing when code is pushed. Could use n8n or simple service.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:10:54.5664-05:00","updated_at":"2025-12-19T11:10:54.5664-05:00","labels":["automation","phase5"]}
{"id":"harness-7ff","title":"Integration Test: End-to-end search workflow validation","description":"Full end-to-end test of the search workflow with real repos and services.\n\nTest Workflow:\n1. harness scan ~/dev (5+ repos)\n2. harness index (all repos)\n3. harness search 'authentication' (unfiltered)\n4. harness search 'auth' --repo=api (filtered)\n5. Start agent, verify context shows indexed repos\n6. Agent task: 'find error handling code' - uses semantic search\n\nAcceptance Criteria:\n- [ ] Scan discovers all expected repos\n- [ ] Index completes without errors\n- [ ] Search returns relevant results\n- [ ] Filtered search scopes correctly\n- [ ] Agent context shows indexed repos\n- [ ] Agent successfully uses semantic_search tool\n- [ ] Performance acceptable (\u003c5s for search)\n- [ ] Document any issues found for future improvement","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T13:14:43.651577-05:00","updated_at":"2025-12-19T13:14:43.651577-05:00","labels":["phase2-search"]}
{"id":"harness-7qx","title":"Indexer Throttling: Rate limit embedding requests to be a good citizen","description":"Add configurable rate limiting for Ollama embedding calls. Batch size limits. Optional delay between repos. Prevents overloading Ollama during large index jobs.\n\nAcceptance Criteria:\n- [ ] Configurable batch size (default: 10 texts per call)\n- [ ] Configurable delay between batches (default: 0)\n- [ ] Configurable delay between repos (default: 0)\n- [ ] Config via env vars or index.yaml\n- [ ] Unit tests for batching logic\n- [ ] Manual test: index large repo, verify Ollama not overwhelmed","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T12:51:09.412755-05:00","updated_at":"2025-12-19T13:14:35.040413-05:00","labels":["phase2-search"]}
{"id":"harness-8r3","title":"Indexer Repo Field: Add repo name to Qdrant payload for filtering","description":"Update indexer.py to add 'repo' field to Qdrant payload. Derive repo name from path (e.g., ~/dev/billing-api → billing-api). Enables filtering searches by repo.\n\nAcceptance Criteria:\n- [ ] Payload includes 'repo' field derived from path\n- [ ] Repo name extraction handles edge cases (trailing slash, nested paths)\n- [ ] Existing tests updated for new field\n- [ ] New unit tests for repo name extraction\n- [ ] Manual test: index repo, verify payload in Qdrant has repo field","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T12:41:52.097925-05:00","updated_at":"2025-12-19T13:14:21.675856-05:00","labels":["phase2-search"]}
{"id":"harness-b19","title":"Test Scenarios: Initial scenario suite for Contrast MCP tools","description":"Create initial set of test scenarios covering all 28 Contrast MCP tools.\n\nCoverage goals:\n- Every Contrast tool exercised at least once\n- Mix of L1 (direct), L2 (inferred), L3 (chain) complexity\n- Categories: discovery, vulns, libraries, coverage, attacks, scans\n\nInitial scenarios (~20-30):\n- Discovery (5): list apps, find by tag/metadata\n- Vulnerabilities (8): list, filter, details, by CVE\n- Libraries (3): list libs, find by app\n- Route Coverage (4): coverage queries\n- Attacks/ADR (3): rules, attacks\n- Scans (2): projects, results\n- Chains (5): multi-tool workflows\n\nAcceptance Criteria:\n- [ ] All 28 Contrast tools have at least one scenario\n- [ ] Scenarios in YAML format in scenarios/ directory\n- [ ] Each scenario has expected_tools defined\n- [ ] Mix of complexity levels\n- [ ] Scenarios validated against schema\n- [ ] Manual test: run suite, verify all tools exercised","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-19T14:00:37.822523-05:00","updated_at":"2025-12-19T14:00:37.822523-05:00","labels":["appsec-testing"]}
{"id":"harness-b8w","title":"Qdrant Python Integration: Set up qdrant-client and create QdrantClient singleton","description":"Set up qdrant-client in harness/__init__.py or dedicated module. Create singleton QdrantClient that reads host/port from environment variables (QDRANT_HOST, QDRANT_PORT). Create 'code' collection with 768-dim vectors for nomic-embed-text. See plan.md Phase 2.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:07:32.70853-05:00","updated_at":"2025-12-19T11:26:10.102459-05:00","closed_at":"2025-12-19T11:26:10.102461-05:00","labels":["phase2","qdrant"]}
{"id":"harness-cfx","title":"Metrics \u0026 Analysis: Summarize test results and tool usage patterns","description":"Aggregate test results into actionable metrics. Easy to summarize, easy to compare runs.\n\nMetrics:\n- tool_precision: expected tools called / total calls\n- tool_recall: expected tools called / expected tools\n- success_rate: scenarios without errors\n- avg_duration_ms: per scenario and overall\n- tool_frequency: which tools used most\n- tool_chains: common sequences\n- error_breakdown: by type/tool\n\nOutput formats:\n- Summary to stdout\n- Full report JSON\n- CSV for spreadsheet analysis\n\nCommands:\n- harness analyze results.json\n- harness analyze results/ --compare\n\nAcceptance Criteria:\n- [ ] Calculates precision, recall, success rate\n- [ ] Tool frequency histogram\n- [ ] Tool chain detection\n- [ ] Error categorization\n- [ ] Summary output human-readable\n- [ ] JSON/CSV export\n- [ ] Compare multiple runs\n- [ ] Unit tests for calculations\n- [ ] Manual test: analyze real results, verify accuracy","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-19T14:00:28.123912-05:00","updated_at":"2025-12-19T14:00:28.123912-05:00","labels":["appsec-testing"]}
{"id":"harness-ci3","title":"Automation: On-demand indexing Job for ad-hoc reindexing","description":"Create K8s Job template for triggering reindexing manually. Should mount host repos and run harness.indexer module.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:10:20.982522-05:00","updated_at":"2025-12-19T11:10:20.982522-05:00","labels":["automation","phase5"]}
{"id":"harness-d3a","title":"Seed Repos: Add vulnerable test applications to container","description":"Add known vulnerable repos to container for consistent testing. Register them in Contrast for realistic data.\n\nOptions:\n- OWASP WebGoat (Java)\n- OWASP Juice Shop (Node)\n- Custom minimal app with controlled CVEs\n\nImplementation:\n- Add to Dockerfile or init script\n- Configure in Contrast (may need manual setup initially)\n- Document which vulns are expected\n\nAcceptance Criteria:\n- [ ] At least one vulnerable app in container\n- [ ] App registered in Contrast with known vulnerabilities\n- [ ] Documentation of expected vulns for test validation\n- [ ] Reproducible setup (scripted, not manual)\n- [ ] Manual test: query Contrast for app, see expected vulns","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-19T14:00:06.402271-05:00","updated_at":"2025-12-19T14:00:06.402271-05:00","labels":["appsec-testing"]}
{"id":"harness-ef4","title":"AppSec Persona: Security-focused agent mode with Contrast expertise","description":"Create AppSec engineer persona that auto-enables when Contrast env vars present. Custom system prompt that knows Contrast tools, security workflows, and remediation guidance.\n\nImplementation:\n- Detect CONTRAST_API_KEY at startup\n- Load appsec system prompt (knows all 28 Contrast tools)\n- Prioritize security-focused responses\n- Guide agent to use Contrast tools for security queries\n\nAcceptance Criteria:\n- [ ] AppSec prompt in harness/prompts/appsec.py\n- [ ] Auto-detection of Contrast credentials\n- [ ] System prompt lists Contrast tool categories\n- [ ] Agent uses Contrast tools for security questions\n- [ ] Unit tests for persona selection\n- [ ] Manual test: ask security question, verify tool usage","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-19T13:59:59.121734-05:00","updated_at":"2025-12-19T13:59:59.121734-05:00","labels":["appsec-testing"]}
{"id":"harness-ep8","title":"Tool Call Logger: Comprehensive MCP call telemetry","description":"Intercept and log all MCP tool calls with full details. No data wasted - capture everything measurable.\n\nCapture per call:\n- Timestamp, tool name, arguments\n- Response content, duration_ms\n- Success/failure, error details\n- Token usage (if available)\n- Conversation context (message index)\n\nStorage:\n- JSONL format for easy processing\n- Configurable output path\n- Optional stdout streaming\n\nAcceptance Criteria:\n- [ ] All MCP calls logged with full details\n- [ ] JSONL output format\n- [ ] Configurable via env var (LOG_TOOL_CALLS=true)\n- [ ] Log file path configurable\n- [ ] Includes timestamp, duration, success/error\n- [ ] Captures full args and response\n- [ ] Unit tests for logger\n- [ ] Manual test: run agent, verify log file complete","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-19T14:00:26.671894-05:00","updated_at":"2025-12-19T14:00:26.671894-05:00","labels":["appsec-testing"]}
{"id":"harness-jvi","title":"Indexer Resilience: Add retry logic, resume on failure, progress tracking","description":"Split indexing into resumable chunks. Track progress per-repo. Retry failed embeddings with backoff. Save checkpoint state to resume after failures. Add progress output (X/Y repos, N files indexed).\n\nAcceptance Criteria:\n- [ ] Checkpoint file tracks indexed repos/files\n- [ ] Resume skips already-indexed content\n- [ ] Retry with exponential backoff on embedding failures\n- [ ] Progress output: 'Indexing repo X/Y: name (N files)'\n- [ ] Graceful handling of Ctrl+C (saves checkpoint)\n- [ ] Unit tests for checkpoint save/load\n- [ ] Manual test: interrupt indexing, resume, verify no duplicates","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T12:51:08.981893-05:00","updated_at":"2025-12-19T13:14:22.162441-05:00","labels":["phase2-search"]}
{"id":"harness-mpy","title":"Qdrant Embedding Pipeline: Implement embedding generation using Ollama nomic-embed-text","description":"Create harness/embedding.py with function to generate embeddings via ollama.embed() using nomic-embed-text model. Return 768-dimensional vectors suitable for Qdrant. See plan.md Phase 2.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:07:41.482472-05:00","updated_at":"2025-12-19T11:26:45.153842-05:00","closed_at":"2025-12-19T11:26:45.153844-05:00","labels":["phase2","qdrant"]}
{"id":"harness-nbe","title":"Test Runner: Automated scenario execution engine","description":"Execute test scenarios from YAML files, capture results, no human in loop.\n\nFeatures:\n- Load scenarios from YAML\n- Run agent with prompt\n- Capture tool calls via logger\n- Record response and metrics\n- Support batch execution\n- Deterministic (same scenario = comparable results)\n\nScenario format:\n  id, name, prompt, expected_tools, level, tags\n\nResult format:\n  scenario_id, tools_called, sequence, response, duration, errors\n\nAcceptance Criteria:\n- [ ] YAML scenario format defined\n- [ ] Runner executes scenarios in sequence\n- [ ] Integrates with tool call logger\n- [ ] Results output to JSON\n- [ ] Handles errors gracefully (continues suite)\n- [ ] Supports filtering by tag/level\n- [ ] Unit tests for runner\n- [ ] Manual test: run 5 scenarios, verify results file","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-19T14:00:27.155489-05:00","updated_at":"2025-12-19T14:00:27.155489-05:00","labels":["appsec-testing"]}
{"id":"harness-ote","title":"Automation: CronJob for scheduled codebase reindexing","description":"Create K8s CronJob that runs nightly to reindex code repositories into Qdrant. See k8s_plan.md Phase 5 for template.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T11:09:15.959962-05:00","updated_at":"2025-12-19T11:09:15.959962-05:00","labels":["automation","phase5"]}
{"id":"harness-u3i","title":"Filtered Search: Add repo/tags filters to SemanticSearchTool","description":"Add optional filters to SemanticSearchTool: repo (single), repos (list), tags (list), directory (root path). Use Qdrant Filter with FieldCondition for filtering.\n\nAcceptance Criteria:\n- [ ] Filter by single repo: semantic_search(query, repo='api')\n- [ ] Filter by multiple repos: semantic_search(query, repos=['api', 'web'])\n- [ ] Filter by tags: semantic_search(query, tags=['backend'])\n- [ ] Filters combine with AND logic\n- [ ] Tool documentation updated with new params\n- [ ] Unit tests for filter construction\n- [ ] Manual test: search with/without filters, verify scoping works","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T12:41:52.539477-05:00","updated_at":"2025-12-19T13:14:35.462458-05:00","labels":["phase2-search"]}
{"id":"harness-upk","title":"CLI Commands: Add harness scan, harness index, harness search commands","description":"Add CLI subcommands: 'harness scan \u003cdir\u003e' - scan and populate config, 'harness index' - index all configured repos, 'harness search \u003cquery\u003e' - test search from CLI. Use argparse or click.\n\nAcceptance Criteria:\n- [ ] harness scan \u003cdir\u003e - scans dir, updates config, shows found repos\n- [ ] harness index - indexes all repos in config, shows progress\n- [ ] harness index \u003crepo\u003e - indexes single repo\n- [ ] harness search \u003cquery\u003e - runs search, displays results\n- [ ] harness search \u003cquery\u003e --repo=X - filtered search\n- [ ] --help works for all commands\n- [ ] Manual test: full workflow scan → index → search","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T12:41:53.478104-05:00","updated_at":"2025-12-19T13:14:36.287161-05:00","labels":["phase2-search"]}
{"id":"harness-urd","title":"Index Config: Store discovered repos and index state in ~/.harness/","description":"Create ~/.harness/index.yaml to store: root directories to scan, discovered repos with metadata, user-added tags per repo, last indexed timestamp. Auto-populated by scanner, editable by user.\n\nAcceptance Criteria:\n- [ ] YAML schema defined and documented\n- [ ] Load/save functions work correctly\n- [ ] Merges scanner results with existing config (doesn't overwrite user tags)\n- [ ] Tracks last_indexed timestamp per repo\n- [ ] Creates ~/.harness/ dir if missing\n- [ ] Unit tests for config load/save/merge\n- [ ] Manual test: edit tags, re-scan, verify tags preserved","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-19T12:41:51.621944-05:00","updated_at":"2025-12-19T13:14:21.258408-05:00","labels":["phase2-search"]}
{"id":"harness-v8y","title":"Qdrant Code Indexer: Build indexer for Python/code files with chunking strategy","description":"Create harness/indexer.py with code file indexer. Chunking strategy: ~500 lines or by function/class. Store filepath, language, content as payload. Support Python initially, extend to other languages. See plan.md Phase 2.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:08:46.154318-05:00","updated_at":"2025-12-19T11:27:26.83328-05:00","closed_at":"2025-12-19T11:27:26.833281-05:00","labels":["phase2","qdrant"]}
{"id":"harness-xzs","title":"Qdrant SemanticSearchTool: Add semantic search tool to agent tools","description":"Create SemanticSearchTool class in harness/tools/search.py. Takes natural language query, embeds it, searches Qdrant, returns top-k relevant code chunks. Integrate with MCP tool system. See plan.md Phase 2.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-19T11:09:03.047606-05:00","updated_at":"2025-12-19T11:29:42.904017-05:00","closed_at":"2025-12-19T11:29:42.904019-05:00","labels":["phase2","qdrant"]}
